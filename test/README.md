# テスト用画像セット

このディレクトリには、手書き数字認識アプリケーションの単体テスト用のサンプル画像が含まれています。

## 📁 ディレクトリ構造

```
test/
├── images/
│   ├── digits/          # 基本数字画像（0-9）
│   ├── edge_cases/      # エッジケース画像
│   ├── invalid/         # 無効画像
│   └── README.md        # このファイル
└── generate_test_images.py  # 画像生成スクリプト
```

## 🔢 基本数字画像 (digits/)

各数字（0-9）について、以下の2つのバージョンが用意されています：

### 白背景黒文字版
- `0.png` - 数字0 (想定結果: 0)
- `1.png` - 数字1 (想定結果: 1)
- `2.png` - 数字2 (想定結果: 2)
- `3.png` - 数字3 (想定結果: 3)
- `4.png` - 数字4 (想定結果: 4)
- `5.png` - 数字5 (想定結果: 5)
- `6.png` - 数字6 (想定結果: 6)
- `7.png` - 数字7 (想定結果: 7)
- `8.png` - 数字8 (想定結果: 8)
- `9.png` - 数字9 (想定結果: 9)

### 黒背景白文字版
- `0_black.png` - 数字0 (想定結果: 0)
- `1_black.png` - 数字1 (想定結果: 1)
- `2_black.png` - 数字2 (想定結果: 2)
- `3_black.png` - 数字3 (想定結果: 3)
- `4_black.png` - 数字4 (想定結果: 4)
- `5_black.png` - 数字5 (想定結果: 5)
- `6_black.png` - 数字6 (想定結果: 6)
- `7_black.png` - 数字7 (想定結果: 7)
- `8_black.png` - 数字8 (想定結果: 8)
- `9_black.png` - 数字9 (想定結果: 9)

## 🔍 エッジケース画像 (edge_cases/)

認識の難しいケースをテストするための画像：

- `blurry.png` - ぼやけた数字5 (想定結果: 5, 但し信頼度は低め)
- `rotated.png` - 回転した数字7 (想定結果: 7, 但し信頼度は低め)
- `noisy.png` - ノイズの多い数字3 (想定結果: 3, 但し信頼度は低め)

## ❌ 無効画像 (invalid/)

認識できない、または誤った結果になることが予想される画像：

- `not_a_digit.png` - 数字以外の文字「A」 (想定結果: 予測不可または誤認識)
- `multiple_digits.png` - 複数の数字「12」 (想定結果: 予測不可または誤認識)

## 🧪 テスト実行方法

### 1. 個別画像のテスト

```bash
# 仮想環境をアクティベート
source venv/bin/activate

# 単一画像をテスト
python ml/predict.py test/images/digits/5.png

# 期待される出力例:
# {"digit": 5, "confidence": 0.95}
```

### 2. 全画像の一括テスト

```bash
# 基本数字画像を一括テスト
for file in test/images/digits/*.png; do
    echo "Testing: $file"
    python ml/predict.py "$file"
    echo "---"
done
```

### 3. バックエンドAPIを使用したテスト

```bash
# サーバーを起動
npm run dev-server

# 別のターミナルでcurlを使用してテスト
curl -X POST -F "image=@test/images/digits/5.png" http://localhost:5000/api/predict
```

### 4. フロントエンドでのテスト

1. アプリケーションを起動: `npm run dev`
2. ブラウザで `http://localhost:3000` を開く
3. テスト画像をドラッグ&ドロップまたはファイル選択でアップロード
4. 結果を確認

## 📊 予想される結果

### 基本数字画像
- **成功率**: 95%以上
- **信頼度**: 0.8以上

### エッジケース画像
- **成功率**: 70%以上
- **信頼度**: 0.5以上

### 無効画像
- **成功率**: 10%以下（意図的に低い）
- **信頼度**: 0.3以下

## 🔧 画像の再生成

テスト画像を再生成したい場合：

```bash
# 仮想環境をアクティベート
source venv/bin/activate

# 画像生成スクリプトを実行
python generate_test_images.py
```

## 📝 注意事項

- 画像はすべて64x64ピクセルで生成されていますが、アプリケーションの前処理により28x28ピクセルにリサイズされます
- 背景色検出機能により、白背景と黒背景の両方が適切に処理されます
- エッジケース画像は認識の限界をテストするために意図的に作成されています
- 無効画像は期待通りに認識されない可能性があります（これは正常な動作です）

## 🐛 トラブルシューティング

### 画像が認識されない場合

1. ファイル形式がPNG/JPEGであることを確認
2. ファイルサイズが2MB以下であることを確認
3. 画像に数字が含まれていることを確認
4. サーバーが正常に起動していることを確認

### 予期しない結果が出る場合

1. 画像の品質を確認（ぼやけていないか、ノイズが多くないか）
2. 数字が画像の中央に位置していることを確認
3. 背景と文字のコントラストが十分であることを確認

## 📚 参考情報

- モデルの訓練: `ml/train_model.py`
- 予測処理: `ml/predict.py`
- サーバーAPI: `server/routes/predict.js`
- フロントエンド: `client/src/App.jsx`