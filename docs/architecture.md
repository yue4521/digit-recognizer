# アーキテクチャ

## システム構成

digit-recognizerは3層アーキテクチャで構成されています：

1. **フロントエンド (React)**
2. **バックエンド (Node.js + Express)**
3. **機械学習 (Python)**

## コンポーネント詳細

### フロントエンド (client/)

- **ポート**: 3000
- **フレームワーク**: React 18
- **主要機能**:
  - ドラッグ&ドロップファイルアップロード
  - 画像プレビュー機能
  - ローディング状態管理
  - エラーハンドリング
  - レスポンシブデザイン

#### ファイル構成

```
client/
├── public/
│   └── index.html          # HTMLテンプレート
├── src/
│   ├── App.jsx            # メインReactコンポーネント
│   ├── App.css            # アプリケーションスタイル
│   ├── index.js           # Reactエントリーポイント
│   └── index.css          # グローバルスタイル
└── package.json           # 依存関係とスクリプト
```

### バックエンド (server/)

- **ポート**: 5000
- **フレームワーク**: Express.js
- **主要機能**:
  - ファイルアップロード処理 (multer)
  - CORS対応
  - Pythonスクリプト実行
  - 一時ファイル管理

#### ファイル構成

```
server/
├── routes/
│   └── predict.js         # 予測APIエンドポイント
├── index.js               # Expressサーバーメイン
└── package.json           # 依存関係とスクリプト
```

### 機械学習 (ml/)

- **言語**: Python 3.8+
- **主要ライブラリ**: scikit-learn, PIL, numpy
- **モデル**: サポートベクターマシン (SVM)

#### ファイル構成

```
ml/
├── train_model.py         # モデル訓練スクリプト
├── predict.py             # 予測実行スクリプト
├── requirements.txt       # Python依存関係
└── svm_model.pkl          # 訓練済みモデル（生成される）
```

## データフロー

1. **ユーザー操作**: Reactフロントエンドでファイルをアップロード
2. **ファイル送信**: `/api/predict`エンドポイントにPOSTリクエスト
3. **ファイル処理**: ExpressサーバーがmulterでファイルをUploadフォルダに保存
4. **予測実行**: PythonスクリプトがNode.jsから子プロセスとして実行
5. **画像前処理**: PILで画像をMNIST形式に変換
6. **予測**: SVMモデルで数字を予測
7. **結果返却**: JSON形式で予測結果と信頼度を返却
8. **ファイル削除**: 一時ファイルを自動削除
9. **結果表示**: Reactで予測結果を表示

## セキュリティ設計

### ファイル検証
- ファイル形式制限 (JPEG/PNGのみ)
- ファイルサイズ制限 (最大2MB)
- MIMEタイプ検証

### データ保護
- 一時ファイルの自動削除
- 入力サニタイゼーション
- CORS設定

### プロセス分離
- Python処理の子プロセス実行
- エラーハンドリングによる異常終了防止

## パフォーマンス考慮事項

### フロントエンド
- 画像プレビューの最適化
- ローディング状態の適切な表示
- エラー状態の明確な表示

### バックエンド
- ファイルアップロードの制限
- 同期処理によるレスポンス保証
- メモリ使用量の最適化

### 機械学習
- 画像前処理の効率化
- モデルロード時間の最小化
- 予測時間の最適化（平均500ms）

## スケーラビリティ

### 現在の制約
- 単一プロセスでの処理
- ファイルストレージの制限
- セッション管理なし

### 将来の拡張性
- ロードバランサーの追加
- データベース統合
- クラウドストレージ連携
- マイクロサービス化